require './textmenu.scss'


HEIGHT = 30
MARGIN = 20

TextMenu = React.createClass
	getInitialState: ->
		selectionRect: @props.selection.rect

	componentWillReceiveProps: (nextProps) ->
		@setState {
			selectionRect: nextProps.selection.rect
			commands: nextProps.selection.textCommands
		}

	renderImg: (command) ->
		if not command.image? then return `<div><span>{command.label}</span><img className="click-blocker" /></div>`

		React.createElement 'img', { src:command.image }

	onMouseDown: (label) ->
		event.preventDefault()
		event.stopPropagation()

		@props.commandHandler(label)

	render: ->
		if not @props.controlsEl then return null
		if not @props.enabled then return null

		ctrlRect = @props.controlsEl.getBoundingClientRect()
		selRect = @state.selectionRect
		renderImg = @renderImg

		if not selRect or not @state.commands or @state.commands.length is 0 then return null

		React.createElement('div', { className:'editor--components--text-menu', style: {
			left: (selRect.left + (selRect.width / 2) - ctrlRect.left) + 'px'
			top: (selRect.top - ctrlRect.top - MARGIN - HEIGHT) + 'px'
			height: HEIGHT + 'px'
		}},
			@state.commands.map ((command, index) ->
				React.createElement('a', {
					onMouseDown: @onMouseDown.bind(null, command.label)
					key: index
				}, renderImg(command))
			).bind(@)
		)


module.exports = TextMenu